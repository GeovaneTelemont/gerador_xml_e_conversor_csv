{% extends "base.html" %}

{% block title %}Conversor de CSV{% endblock %}

{% block page_title %}üîÑ Conversor de CSV{% endblock %}

{% block page_subtitle %}
<p class="lead">Converta Enderecos_Totais_CO.csv para formato Power Query</p>
<a href="/" class="btn btn-secondary mb-4">
    <i class="fas fa-arrow-left"></i> Voltar ao In√≠cio
</a>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/conversor.css') }}">
{% endblock %}

{% block content %}
<div class="row mt-4">
    <div class="col-12">
        <div class="upload-box rounded-3">
            <form method="POST" enctype="multipart/form-data" id="uploadForm">
                <div class="mb-3">
                    <label for="file" class="form-label">Selecione o arquivo Enderecos_Totais_CO.csv:</label>
                    <input class="form-control" type="file" name="file" id="file" accept=".csv" required>
                    <div class="file-info" id="fileInfo">
                        üìÅ Tamanho m√°ximo: 2GB | Formato: CSV com separador |
                    </div>
                    
                    <!-- Resultado da Valida√ß√£o -->
                    <div id="validationResult" class="validation-result" style="display: none;">
                        <div id="validationContent"></div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn" disabled>
                    üîÑ Converter Arquivo
                </button>
            </form>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>‚ÑπÔ∏è Informa√ß√µes do Conversor</h5>
            </div>
            <div class="card-body">
                <p><strong>Este conversor realiza as seguintes opera√ß√µes:</strong></p>
                <ul>
                    <li>Formata CEP e COD_LOGRADOURO</li>
                    <li>Cria CHAVE LOG para agrupamento</li>
                    <li>Processa COMPLEMENTO3 com numera√ß√£o autom√°tica</li>
                    <li>Adiciona informa√ß√µes de roteiro</li>
                    <li>Gera valida√ß√µes dos dados</li>
                    <li>Formata para Power Query (UTF-8 com BOM)</li>
                </ul>
                
                <p><strong>Colunas obrigat√≥rias no CSV:</strong></p>
                <div class="colunas-lista">
                    <ul class="list-unstyled">
                        {% for coluna in [
                            'CELULA', 'ESTACAO_ABASTECEDORA', 'UF', 'MUNICIPIO', 'LOCALIDADE', 
                            'COD_LOCALIDADE', 'LOCALIDADE_ABREV', 'LOGRADOURO', 'COD_LOGRADOURO', 
                            'NUM_FACHADA', 'COMPLEMENTO', 'COMPLEMENTO2', 'COMPLEMENTO3', 'CEP', 
                            'BAIRRO', 'COD_SURVEY', 'QUANTIDADE_UMS', 'COD_VIABILIDADE', 
                            'TIPO_VIABILIDADE', 'TIPO_REDE', 'UCS_RESIDENCIAIS', 'UCS_COMERCIAIS', 
                            'NOME_CDO', 'ID_ENDERECO', 'LATITUDE', 'LONGITUDE', 'TIPO_SURVEY', 
                            'REDE_INTERNA', 'UMS_CERTIFICADAS', 'REDE_EDIF_CERT', 'DISP_COMERCIAL', 
                            'ESTADO_CONTROLE', 'DATA_ESTADO_CONTROLE', 'ID_CELULA', 'QUANTIDADE_HCS'
                        ] %}
                            <li><code>{{ coluna }}</code></li>
                        {% endfor %}
                    </ul>
                </div>
                
                <p><strong>Arquivo de entrada:</strong> Enderecos_Totais_CO.csv (separador |)</p>
                <p><strong>Arquivo de sa√≠da:</strong> CSV formatado para Power Query (separador ;)</p>
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Para arquivos grandes (760MB+):</strong>
                    <ul class="mb-0">
                        <li>O processamento pode levar v√°rios minutos</li>
                        <li>Recomendado para servidores com boa mem√≥ria RAM</li>
                        <li>Ser√° processado em partes para otimizar performance</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/conversor.js') }}"></script>
{% endblock %}